<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Nowe ogloszenie</title>
    <style>
   
        .form {
            display: flex;
            flex-direction: column;
            max-width: 50vw;
            margin: 0 auto;
        }
        @media screen and (max-width: 550px) {
            .form {
                max-width: 90vw;
        }
        }

    </style>
</head>
<body style="background-color: black;min-height: 100vh;color: white;">
    <center>
        <h1>Dodaj ogloszenie</h1>
        <form  class="form" action="/upload" method="post" enctype="multipart/form-data">
            <label for="image">Wybierz zdjecia</label>
            <input type="file" name="image" multiple required id="files" />
            <input placeholder="Podaj tytul" type="text" name="title" id="title" required>
            <input placeholder="Podaj cene" type="number" name="price" id="price" required>
            <textarea placeholder="Wpisz opis" type="text" name="description" id="description" cols="30" rows="10" required></textarea>
            <button class="button" type="submit">Submit</button>
        </form>
        <h4 class="response"></h4>
    </center>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        const button = document.querySelector(".button")
        const imagefile = document.querySelector('#files');
        const title = document.querySelector("#title");
        const price = document.querySelector("#price");
        const desc = document.querySelector("#description")
        const response = document.querySelector(".response")
        const formData = new FormData();
        let totalSize = 0
        const config = {
            onUploadProgress: progressEvent => response.innerText = `${Math.round((progressEvent.loaded/totalSize)*100)} % przeslane` 
        }

        imagefile.addEventListener("input", (e) => {
            let files = [...e.target.files];
            for (let item of files) {
            formData.append('image', item)
            }
        })
        button.addEventListener("click", (e) => {
            e.preventDefault();
           
            formData.getAll("image")?.forEach(element => {
                totalSize += element.size;
            });

            formData.append('title', title.value)
            formData.append('price', price.value)
            formData.append('description', description.value)
            axios.post('/upload', formData, config, {
            headers: {
                'Content-Type': 'multipart/form-data'
            }
             }).then((res) => {
                 response.innerText = res.data
                 totalSize = 0;
                })
        })
       
        const getTodoItems = async () => {
        try {
            const response = await axios.get(`https://doge-memes.com/api/auctions`);
            const todoItems = response.data;
            console.log(`GET: Here's the list of todos`, todoItems);
            return todoItems;
        } catch (error) {
            console.error(error);
        }
        }

    getTodoItems();
    </script>
</body>
</html>